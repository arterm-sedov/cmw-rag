---
alwaysApply: true
---

- Before any coding gather information:
    - search internet for reference documentation on the frameworks and libraries to use
    - then go to the official documentation sources you found and digest the best practices
    - do not read just a page or to, scan the docs and links and doc hierarchy
    - gather all the information to base your actions on ground truth
- PLAN your course of action after gathering the reference info.
- Code style: langchain-pure, super dry, super lean, abstract, modular, pythonic, super smart, modular, linted, deduplicated, pydantic, pythonic
- Always run linter after making any changes:
    - Use Ruff as the primary linter: `ruff check <file_path>` for specific files
    - Run Ruff before committing: `ruff check <file_path>` for changed files only
    - Be critical about Ruff reports, implement only the necessary changes
    - Only lint the files that were modified, not the entire codebase
    - Configuration in pyproject.toml follows LangChain and Gradio best practices
- Ensure testability and extensibility.
- Avoid unnecessary try-catches.
- When refactoring code, change only the levant parts.
- Prefer LangChain purity for LangChain code.
- Use sentence_transformers when needed and practical.
- Follow LangChain's best practices, patterns, and conventions:
    - https://docs.langchain.com/oss/python/langchain/overview
    - https://docs.langchain.com/oss/python/langchain/agents
    - https://reference.langchain.com/python/langchain/agents/
    - https://docs.langchain.com/oss/python/langchain/models
    - https://reference.langchain.com/python/langchain/models/
    - https://docs.langchain.com/oss/python/langchain/messages
    - https://reference.langchain.com/python/langchain/messages/
    - https://docs.langchain.com/oss/python/langchain/tools
    - https://reference.langchain.com/python/langchain/tools/
    - https://docs.langchain.com/oss/python/langchain/short-term-memory
    - https://docs.langchain.com/oss/python/langchain/streaming
    - https://docs.langchain.com/oss/python/langchain/middleware
    - https://reference.langchain.com/python/langchain/middleware/
    - https://reference.langchain.com/python/langchain/
    - https://langchain-ai.github.io/langgraph/concepts/memory/
    - https://reference.langchain.com/python/integrations/
    - https://docs.langchain.com/oss/python/langchain/quickstart
    - https://docs.langchain.com/oss/python/langchain/philosophy
    - https://docs.langchain.com/oss/python/langchain/runtime
    - https://langchain-ai.github.io/langgraph/guides/
    - https://langchain-ai.github.io/langgraph/concepts/streaming/
    - https://langchain-ai.github.io/langgraph/concepts/memory/
- Ensure Gradio purity when possible.
- Follow Gradio's best practices, patterns, and conventions:
    - https://www.gradio.app/docs
    - https://www.gradio.app/guides/the-interface-class/
    - https://www.gradio.app/guides/interface-state/
    - https://www.gradio.app/guides/blocks-and-event-listeners/
    - https://www.gradio.app/guides/controlling-layout/
    - https://www.gradio.app/guides/dynamic-apps-with-render-decorator/
- Follow Python's best practices, patterns, and conventions:
    - https://peps.python.org/pep-0008/
    - https://peps.python.org/pep-0257/
    - https://google.github.io/styleguide/pyguide.html
    - https://docs.python-guide.org/
- Group and isolate code based on its function in different files to avoid clutter.
- Do not duplicate code, encapsulate any reused code in methods/functions.
- Never break existing code.
- Do not delete logging, but update it.
- Do not delete comments, rather update them.
- Produce flawless code.
- Reanalyze your changes twice for any issues you might have introduced.
- Place imports always on top.
- Use environment variables for secrets.
- Put reports to a relevant `docs/**/progress_reports/` folder under `/docs/`
- Put tests to `/rag_engine/tests` preferably.
- Always update and run testsuite after any changes.
    - LangChain Test docs https://docs.langchain.com/oss/python/langchain/test
- Always update readme after any changes that affect it.
- Avoid try/except-heavy code and hardcoded fallbacks. Prefer robust, explicit logic, and catch exceptions only when necessary and meaningful. Code should work correctly without hidden fallbacks.
